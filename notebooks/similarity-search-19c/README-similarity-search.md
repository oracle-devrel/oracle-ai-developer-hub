# How Can I Create Semantic Similarity Search in Oracle Database 19c?
 
## Introduction

In this lab, you will learn how to **create a similarity search application using LangChain, Streamlit, and Sentence Transformers Hugging Face Model with Oracle Autonomous Database 19c**.

**Similarity search** is a technique that finds items in a dataset that are most similar to a query, rather than looking for exact matches. It works by representing items as numerical vectors (called embeddings) and then using mathematical formulas like cosine similarity or Euclidean distance to find the vectors closest to the query vector. This allows systems to find related items based on shared features, making it useful for applications like image and text search, recommendation systems, and AI-driven analysis.

**Semantic search** is a technique that understands the contextual meaning and intent behind a user's query, going beyond simple keyword matching to find relevant results. It works by converting text into numerical representations called vectors, which are stored in a vector database. The system then compares the vector of a new query to existing vectors to find the most similar ones, effectively connecting ideas even when the exact words are different.

How it works

* **Vectorization**: Data, such as text, images, or audio, is converted into numerical vectors (embeddings). These vectors capture the essence or features of the original item.
* **Similarity calculation**: A similarity measure is used to calculate the "distance" or "angle" between the query vector and the vectors of the items in the dataset.
* **Ranking**: Items are ranked based on their similarity to the query, with the most similar items appearing first.
Retrieval: The system retrieves the items with the highest similarity scores

[SentenceTransformers](https://huggingface.co/sentence-transformers) is a Python framework for state-of-the-art sentence, text and image embeddings.

[all-MiniLM-L6-v2](https://huggingface.co/sentence-transformers/all-MiniLM-L6-v2) is a sentence-transformers model: It maps sentences & paragraphs to a 384 dimensional dense vector space and can be used for tasks like clustering or semantic search.
 
Estimated Time: 2 to 5 minutes.  
 
### Objectives

In this short sprint, you will:
 
* Create a similarity search application using LangChain, Streamlit and Sentence Transformers Hugging Face Mode.

    <!-- [Demo video on Create Oracle Autonomous AI Database](youtube:V2PETW_F7XI:large)  -->

### Prerequisites

This lab assumes you have:

* Oracle cloud account and privileges to create & manage Oracle Autonomous AI Database
* Oracle Autonomous Database 19c has been created and is running.
* Basic knowledge of Python programming language.
* Basic knowledge of SQL and Oracle Database concepts.
 
**Download Source Code** - similaritysearch.py and Create Table script - create-table.sql from [GitHub Repository](https://github.com/madhusudhanrao-ppm/dbdevrel/tree/main/source-codes/similaritysearch) 

## Task 1: Create Table and Insert Sample Records

1. Create Table in Oracle Database 19c (Alternatively You can also use 23ai or 26ai) and insert few sample records

    ```
    <copy>
    CREATE TABLE "MYNOTES" 
    (	
        "ID" NUMBER GENERATED BY DEFAULT ON NULL AS IDENTITY MINVALUE 1 MAXVALUE 99999999 
         INCREMENT BY 1 START WITH 4 CACHE 20 NOORDER  NOCYCLE  NOKEEP  NOSCALE  NOT NULL ENABLE, 
        "NOTES" VARCHAR2(4000 CHAR),  
        CONSTRAINT "MYNOTES_ID_PK" PRIMARY KEY ("ID")
        USING INDEX  ENABLE
    ) ;

    -- Insert records
    INSERT INTO MYNOTES (notes) VALUES ('Travel to Kashmir was an unforgettable experience with stunning landscapes.');
    INSERT INTO MYNOTES (notes) VALUES ('Hotel Booking in Delhi was confirmed for the weekend.'); 
    INSERT INTO MYNOTES (notes) VALUES ('Arrived in Paris, the Eiffel Tower was breathtaking at sunset.');
    INSERT INTO MYNOTES (notes) VALUES ('Loved the croissants at a tiny bakery near the Seine.');
    INSERT INTO MYNOTES (notes) VALUES ('Tokyo streets are incredibly clean and efficient.');
    INSERT INTO MYNOTES (notes) VALUES ('Central Park was a perfect escape from the city buzz.');
    INSERT INTO MYNOTES (notes) VALUES ('Bangkok night markets are a must‑try for street food.');
    INSERT INTO MYNOTES (notes) VALUES ('Sydney Opera House illuminated at night is unforgettable.');
    INSERT INTO MYNOTES (notes) VALUES ('Rome’s ancient ruins are best explored with a guide.');
    INSERT INTO MYNOTES (notes) VALUES ('Tapas in Barcelona were small but packed with flavor.');
    INSERT INTO MYNOTES (notes) VALUES ('Dubai’s desert safari was an exhilarating experience.');
    INSERT INTO MYNOTES (notes) VALUES ('Cape Town’s Table Mountain offered stunning panoramic views.'); 
    INSERT INTO MYNOTES (notes) VALUES ('Patient tolerated surgery well; margins clear.'); 
    INSERT INTO MYNOTES (notes) VALUES ('Started on pembrolizumab - mild fatigue reported.'); 
    INSERT INTO MYNOTES (notes) VALUES ('Completed 6 cycles of FOLFOX; CEA levels decreasing.'); 
    INSERT INTO MYNOTES (notes) VALUES ('Androgen deprivation therapy initiated; PSA dropped to 0.8 ng/mL.'); 
    INSERT INTO MYNOTES (notes) VALUES ('Bilateral lung metastases stable after 8 cycles of nivolumab.'); 
    INSERT INTO MYNOTES (notes) VALUES ('CR achieved after induction; proceeding to consolidation.'); 
    INSERT INTO MYNOTES (notes) VALUES ('Started on gemcitabine + nab‑paclitaxel; mild neutropenia noted.'); 
    INSERT INTO MYNOTES (notes) VALUES ('Debulking surgery successful; plan for platinum‑based chemo.'); 
    INSERT INTO MYNOTES (notes) VALUES ('PET scan shows complete metabolic response after 4 cycles of ABVD.'); 
    INSERT INTO MYNOTES (notes) VALUES ('Total thyroidectomy performed; awaiting radioactive iodine.');
    INSERT INTO MYNOTES (notes) VALUES ('Breast cancer screening scheduled for next month.');
    INSERT INTO MYNOTES (notes) VALUES ('Lung cancer screening scheduled for next month.');
    </copy>
      ``` 

## Task 2: Download Wallet and Connection Details

1. Check the Database version 19c is shown in the Database details page 

    ![DB Conn](images/db-version.png  )

    From the top right navigation menu click on **Database Connection** button to download the wallet and connection details.

    ![DB Conn](images/db-conn.png  )

2. Download wallet and Copy connection details. 

    ![Wallet](images/copy-connection.png  ) 

    Provide wallet password and save the wallet. 

3. Copy and save TNS Name, which would be of the following format, where database name and region will change. we will need this details for database connection.  

    ```
    <copy>
    devdbhs556l_high = (description= (retry_count=20)(retry_delay=3)(address=(protocol=tcps)(port=1522)(host=adb.us-phoenix-1.oraclecloud.com))(connect_data=(service_name=wkrfstesta1jcu_devdbhs556l_high.adb.oraclecloud.com))(security=(ssl_server_dn_match=yes)))
    </copy>  
    ```
  
## Task 3: Upload the Database Wallet files

1. Upload the Database Wallet files to Google Drive and Authorize Drive with Google Colab


## Task 2: Download Wallet and Connection Details

Download and securely store your Oracle Autonomous Database wallet, which contains the credentials needed to connect from Google Colab.

1. In the OCI Console, navigate to your Autonomous Database instance. Note that you can use Oracle Autonomous AI Database 26ai for this lab.

    ![DB Conn](images/db-version.png)

    From the top-right navigation menu, click the **Database Connection** button to access wallet and connection options.

    ![DB Conn](images/db-conn.png)

2. Download the wallet in ZIP format. You will be prompted to provide a wallet password for encryption.

    ![Wallet](images/copy-connection.png)

    Save the wallet file securely. You will need both the wallet files and the wallet password to connect from Google Colab.

3. Extract the wallet ZIP file on your local machine. Inside, you'll find a `tnsnames.ora` file that contains TNS (Transparent Network Substrate) entries. Copy and save the TNS Name you plan to use. The format looks like:

    ```
    <copy>
    mydb_high = (description= (retry_count=20)(retry_delay=3)(address=(protocol=tcps)(port=1522)(host=adb.us-phoenix-1.oraclecloud.com))(connect_data=(service_name=mydb_high.adb.oraclecloud.com))(security=(ssl_server_dn_match=yes)))
    </copy>
    ```

    Note down:
    - Your TNS alias name (e.g., `mydb_high`)
    - Your database username (e.g., `ADMIN`)
    - Your database password
    - Your wallet password

    You will need these details in the later steps to establish the database connection from Google Colab.

## Task 3: Upload Database Wallet Files to Google Drive

Mount Google Drive in Google Colab and upload your wallet files for secure access during Python execution.

**Security Note:** Mounting Google Drive in Colab requires explicit authorization each time you connect to a new Colab runtime. This ensures you maintain full control over what code can access. [Learn more about Colab Drive access](https://research.google.com/colaboratory/faq.html#drive-mount-code-cell)

1. On your local machine, create a folder (e.g., `Wallet_MyDatabase`) containing all the wallet files extracted from the ZIP download.

2. Upload this wallet folder to your Google Drive:

    ![Wallet](images/drive1.png)

3. Open [Google Colab](https://colab.research.google.com/) and create a new notebook. In the left sidebar, click the **Files** icon to access file management.

    ![Wallet](images/drive4.png)

4. Click the **Mount Drive** button or use code to mount Google Drive:

    ```
    <copy>
    from google.colab import drive
    drive.mount('/content/drive')
    </copy>
    ```

    ![Wallet](images/mount.png)

5. A dialog will appear asking you to authorize Google Colab to access your Google Drive. Click the authorization link, sign in with your Google account, copy the verification code, and paste it into the Colab prompt.
    
    ![Wallet](images/conndrive.png)

6. After authorization, you will see your Google Drive folder structure, including your wallet folder.

    ![Wallet](images/drive3.png)

7. Right-click on your wallet folder and select **Copy path** to get the full path. It will look similar to:

    ```
    /content/drive/MyDrive/Wallet_MyDatabase
    ```

    Keep this path for use in the Google Colab Notebook.  